- edit = !f.object.new_record?
- collapsed = session[:entity_extra].nil?
-# entity.attachments.build
= subtitle :entity_extra, collapsed, t(:extra_doc)

.section
  #entity_extra{ hidden_if(collapsed) }
    %table{class: edit ? "edit_form" : "", 'attach_limit' => Setting.attachment_size }
      %tr
        %td
          %input{name: "authenticity_token", value: form_authenticity_token, type: "hidden"}
          - if f.object.attachments.any?
            %ul
              - f.object.attachments.each do |attachment|
                %li
                  = f.hidden_field :attachments, multiple: true, value: attachment.signed_id
                  = link_to "#{attachment.filename} #{number_to_human_size(attachment.byte_size)}", rails_blob_path(attachment, disposition: "attachment")
                  = link_to '#', :data => {:confirm => 'Are you sure want to delete this attachment?'} , class: "remove_link", title: "Remove attachment" do
                    -# Font Awesome v4
                    %i.fa.fa-times-circle
          .new_file
            = f.file_field 'attachments', id: 'attach', multiple: true
            .error_msg Max file size: #{number_to_human_size(Setting.attachment_size)}


          -# = f.simple_fields_for :attachments do |t|
            -# .attach_div
              -# %input{name: "authenticity_token", value: form_authenticity_token, type: "hidden"}

              -# - new_record = t.object.new_record?

              -# = f.file_field 'attachments', id: 'attach', multiple: true

              -# .current_file_name= t.object.try(:attachment_file_name)

              -# .file_size= number_to_human_size(t.object.try(:attachment_file_size)) unless new_record

              -# .remove_link{class: new_record ? "" : "display_remove"}= link_to 'Remove', '#', confirm: new_record ? false : "Are you sure want to delete this attachment?"

          -# .next_attachment
